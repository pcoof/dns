# DNS服务器测试工具

这是一个用于测试DNS服务器响应时间和可用性的现代化工具，采用ttkbootstrap现代化UI设计。

## 新功能特性

### 🎨 现代化界面
- 使用ttkbootstrap提供现代化的UI风格
- 支持多种主题（cosmo, flatly, litera等）
- 更好的视觉体验和用户交互

### 🌐 网络设备管理
- 顶部新增网络设备选择下拉框
- 自动检测系统中的网络适配器
- 支持刷新网络设备列表
- 直接选择要配置DNS的网络接口

### 📊 增强的延迟显示
- 延迟列现在显示格式：`主DNS延迟 | 备用DNS延迟`
- 更直观地查看主备DNS的性能对比
- 支持无限大延迟(∞)和未测试(-)状态显示

### 📂 DNS类别管理
- 新增DNS类别下拉框，支持多种DNS服务器分类
- 内置类别：`Ipv4_默认`、`Ipv4_家庭`、`Ipv4_资源`
- 可在不同类别间快速切换，满足不同使用场景
- 支持刷新类别列表功能

### 🔧 改进的功能
- 更好的错误处理和编码支持
- 优化的网络连接检测算法
- 现代化的对话框设计
- 增强的状态栏信息显示

### 🆕 最新更新
- **新增"默认DNS"按钮**：一键恢复DNS为DHCP自动获取
- **界面优化**：主要操作按钮采用grid布局，实现平均分布
- **字体统一**：全局使用Microsoft YaHei字体，提供更好的中文显示效果
- **按钮布局**：添加DNS → 删除选中 → 开始测试 → 清理DNS缓存 → 默认DNS

### 🔧 列表视图优化
- **行高增加**：设置为45像素，提供更好的可读性
- **双击设置DNS**：双击任意DNS服务器行可直接设置为系统DNS（包括主DNS和备用DNS）
- **颜色对比度优化**：
  - 表头：深灰色背景 + 白色粗体字
  - 交替行：浅灰色(#f1f3f4) 和 白色(#ffffff) 背景
  - 选中行：蓝色背景(#007bff) + 白色字体
  - 状态显示：成功为绿色粗体，失败为红色粗体

### 🛠️ 最新修复
- **底部控件固定**：状态栏固定在底部，列表数据多时仍可见
- **状态颜色修复**：重新组织标签配置，确保状态颜色正确显示
- **DNS设置优化**：
  - 改进错误处理和详细日志输出
  - 更好的管理员权限处理
  - 确保主DNS和备用DNS同时设置
  - 用户友好的错误提示和状态反馈

### 🎯 最终优化
- **静默执行**：管理员权限操作不再弹出命令窗口
- **GitHub链接**：底部右下角添加GitHub图标链接
- **默认DNS修复**：修复默认DNS按钮功能，确保正常工作
- **界面完善**：状态栏左右布局，信息显示更清晰

### 🔧 WMI COM服务实现
- **完全替代命令行**：所有网络操作使用WMI COM服务，不再依赖subprocess
- **技术栈升级**：
  - 使用`win32com.client`和`pythoncom`
  - 查询`Win32_NetworkAdapterConfiguration`类
  - 调用`SetDNSServerSearchOrder()`方法
- **功能覆盖**：
  - 网络信息获取（IP、网关、DNS）
  - 网络适配器列表
  - DNS服务器设置
  - DNS缓存清理
  - DHCP恢复
- **用户体验提升**：
  - 完全消除命令行窗口弹出
  - 更快的执行速度
  - 更好的错误处理
  - 更稳定的编码支持

### 🔐 管理员权限管理
- **强制管理员权限**：
  - 程序启动时自动检查权限状态
  - 如果没有管理员权限，自动尝试以管理员权限重启
  - 如果无法获取管理员权限，显示错误提示并退出程序
- **权限验证**：
  - 使用`ctypes.windll.shell32.IsUserAnAdmin()`检查权限
  - 支持.py和.exe两种文件格式的权限提升
- **权限状态显示**：
  - 窗口标题显示"（管理员权限）"
  - 状态栏显示"就绪 - 管理员权限"
  - 确保所有DNS设置功能正常工作

### 🔧 界面和显示修复
- **窗口居中**：应用程序启动时自动在屏幕中央显示
- **DNS显示更新**：修复默认DNS操作后顶部Label控件不更新的问题
- **实时刷新**：所有DNS设置操作都会自动刷新顶部的主DNS和备用DNS显示
- **异步更新**：使用后台线程刷新，不阻塞用户界面
- **图标修复**：修复应用程序图标加载错误，添加图标文件和异常处理
- **主题选择器**：添加主题切换下拉框，支持21种ttkbootstrap主题，自动保存偏好
- **行高修复**：修复主题切换后列表视图行高变小的问题，保持45像素行高
- **WMI实现**：全面使用WMI COM服务替代命令行操作，消除命令行窗口弹出
- **强制管理员权限**：程序启动时自动要求管理员权限，确保所有功能正常运行

## 使用方法

1. 启动应用程序
2. 在顶部选择要配置的网络设备
3. 选择DNS类别（默认、家庭、资源等）
4. 查看当前类别下的DNS服务器列表
5. 点击"开始测试"测试所有DNS服务器
6. 右键点击DNS服务器可设置为系统DNS
7. 可以在不同类别间切换以使用不同的DNS服务器组
8. **新功能**：点击"默认DNS"按钮可将当前网络适配器的DNS恢复为DHCP自动获取
9. **双击设置**：双击DNS服务器列表中的任意行可直接设置为系统DNS
10. **GitHub链接**：点击底部右下角的GitHub图标可访问项目页面
11. **主题切换**：在管理分类右边的主题下拉框中选择不同的界面主题

## 主要按钮功能

- **添加DNS**：添加新的DNS服务器到当前类别
- **删除选中**：删除选中的DNS服务器条目
- **开始测试**：测试所有DNS服务器的响应时间
- **清理DNS缓存**：清除系统DNS缓存
- **默认DNS**：恢复当前网络适配器的DNS为DHCP自动获取

## 系统要求

- Windows 10/11
- Python 3.13+
- 管理员权限（程序运行必需）

## 安装依赖

```bash
pip install dnspython ttkbootstrap
```

## 运行应用

```bash
python main.py
```